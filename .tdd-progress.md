# TDD Task: Bash Testing Support (bashunit + shellcheck)

**Status:** done
**Created:** 2026-02-14
**Last Updated:** 2026-02-14

---

## Feature Description

Add bash/shell script as a third supported language for the TDD workflow plugin, alongside Dart/Flutter and C++. This enables the plugin to TDD its own hook scripts. The feature requires: (1) a new `bash-testing-conventions` skill with bashunit patterns and shellcheck usage reference docs, (2) updating `validate-tdd-order.sh` to recognize `*_test.sh` test files, (3) updating `auto-run-tests.sh` to run bashunit when `.sh` files change, (4) updating the verifier agent to run bashunit and shellcheck, (5) adding shellcheck and bashunit to `settings.local.json` permissions, and (6) updating all integration points (agents, SKILL.md, CLAUDE.md, README.md, CHANGELOG.md) to reference bash as a supported language.

---

## Requirements

### Functional Requirements
- [ ] New `skills/bash-testing-conventions/` skill directory with SKILL.md and reference docs (bashunit-patterns.md, shellcheck-guide.md)
- [ ] `validate-tdd-order.sh` recognizes `*_test.sh` as test files and `.sh` as source files
- [ ] `auto-run-tests.sh` detects `.sh` file changes and runs bashunit on the matching `_test.sh` file
- [ ] Verifier agent runs `bashunit` for full test suite and `shellcheck` for static analysis on bash projects
- [ ] `settings.local.json` includes `Bash(shellcheck *)` and `Bash(bashunit *)` in allowed permissions
- [ ] Planner and implementer agents list bash-testing-conventions as a loadable skill
- [ ] CLAUDE.md, README.md, tdd-plan SKILL.md, and CHANGELOG.md updated to reference bash as a third language
- [ ] README.md includes bashunit and shellcheck installation instructions
- [ ] README.md notes that users must add permissions to settings.local.json themselves
- [ ] No changes to existing Dart/Flutter or C++ behavior

### Non-Functional Requirements
- [ ] All existing hook scripts pass shellcheck
- [ ] Documentation follows the same structure and depth as existing convention skills
- [ ] CHANGELOG.md updated with changes

---

## Test Specifications

### Slice 1: bash-testing-conventions Skill Structure

**Status:** done

**Source:** `skills/bash-testing-conventions/SKILL.md`
**Tests:** `test/skills/bash_testing_conventions_test.sh`

#### Test 1: SKILL.md exists with correct frontmatter

**Description:** Validates that the bash-testing-conventions SKILL.md follows the same YAML frontmatter pattern as dart-flutter-conventions and cpp-testing-conventions.

**Given:**
- The file `skills/bash-testing-conventions/SKILL.md` exists

**When:**
- The file content is parsed for YAML frontmatter fields

**Then:**
- The `name` field equals `bash-testing-conventions`
- The `description` field references bash, bashunit, and shellcheck
- The `user-invocable` field is `false`
- The frontmatter is delimited by `---` markers

#### Test 2: SKILL.md content references all reference docs

**Description:** Validates that the SKILL.md body references the reference docs that will be created.

**Given:**
- The file `skills/bash-testing-conventions/SKILL.md` exists

**When:**
- The file content is inspected for references to reference documents

**Then:**
- The content references `reference/bashunit-patterns.md`
- The content references `reference/shellcheck-guide.md`
- The content includes a "Running Tests" section with bashunit commands

#### Test 3: Reference directory structure exists

**Description:** Validates the reference directory mirrors the pattern of existing convention skills.

**Given:**
- The directory `skills/bash-testing-conventions/reference/` exists

**When:**
- The directory contents are listed

**Then:**
- `bashunit-patterns.md` exists in the reference directory
- `shellcheck-guide.md` exists in the reference directory

#### Edge Cases

**Description:** Content completeness validation.

**Given:**
- The `skills/bash-testing-conventions/SKILL.md` exists

**When:**
- The file is checked for content completeness

**Then:**
- The file does not contain unfilled template placeholders like `{...}`
- The file is valid markdown with no broken links to reference files

#### Acceptance Criteria
- [ ] All tests pass
- [ ] SKILL.md frontmatter matches the pattern of dart-flutter-conventions/SKILL.md and cpp-testing-conventions/SKILL.md
- [ ] Reference directory contains both bashunit-patterns.md and shellcheck-guide.md
- [ ] No changes to existing dart-flutter-conventions or cpp-testing-conventions

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** none | **Blocks:** Slice 2, Slice 3, Slice 6, Slice 7a

---

### Slice 2: bashunit-patterns.md Reference Document

**Status:** done

**Source:** `skills/bash-testing-conventions/reference/bashunit-patterns.md`
**Tests:** `test/skills/bashunit_patterns_test.sh`

#### Test 1: Contains test structure documentation

**Description:** Validates that the reference doc covers the core bashunit test patterns, mirroring the depth of googletest-patterns.md.

**Given:**
- The file `skills/bash-testing-conventions/reference/bashunit-patterns.md` exists

**When:**
- The file content is inspected for required sections

**Then:**
- The content includes a section on test function naming (`test_` prefix convention)
- The content includes a section on assertion functions (`assert_equals`, `assert_contains`, `assert_exit_code`, `assert_status_code`, etc.)
- The content includes a section on test file naming convention (`*_test.sh` suffix)
- The content includes a section on test file organization and directory structure

#### Test 2: Contains setup/teardown patterns

**Description:** Validates coverage of fixture-like patterns in bashunit.

**Given:**
- The file `skills/bash-testing-conventions/reference/bashunit-patterns.md` exists

**When:**
- The file content is inspected for setup/teardown documentation

**Then:**
- The content documents `set_up` and `tear_down` functions
- The content documents `set_up_before_script` and `tear_down_after_script` functions
- The content includes code examples for each pattern

#### Test 3: Contains running tests section

**Description:** Validates the document covers how to run bashunit tests.

**Given:**
- The file `skills/bash-testing-conventions/reference/bashunit-patterns.md` exists

**When:**
- The file content is inspected for test execution documentation

**Then:**
- The content includes a command to run a single test file: `bashunit test/path_test.sh`
- The content includes a command to run all tests: `bashunit test/`
- The content includes a command to run a specific test by name
- The content includes a section on bash naming conventions (snake_case for files, functions, variables)

#### Edge Cases

**Description:** Structural parity with existing reference docs.

**Given:**
- The file `skills/bash-testing-conventions/reference/bashunit-patterns.md` exists

**When:**
- The file is compared structurally to `skills/cpp-testing-conventions/reference/googletest-patterns.md`

**Then:**
- Both documents have similar section depth (test structure, assertions, fixtures, naming, running tests, references)
- The bash document does not include Dart or C++ specific content

#### Acceptance Criteria
- [x] All tests pass
- [x] bashunit-patterns.md covers: test naming, assertions, fixtures, file organization, running tests, naming conventions
- [x] Code examples use correct bashunit syntax
- [x] Document depth is comparable to googletest-patterns.md

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** Slice 1 | **Blocks:** Slice 6, Slice 7a

---

### Slice 3: shellcheck-guide.md Reference Document

**Status:** done

**Source:** `skills/bash-testing-conventions/reference/shellcheck-guide.md`
**Tests:** `test/skills/shellcheck_guide_test.sh`

#### Test 1: Covers basic usage

**Description:** Validates that the shellcheck reference document covers the core usage patterns.

**Given:**
- The file `skills/bash-testing-conventions/reference/shellcheck-guide.md` exists

**When:**
- The file content is inspected for required sections

**Then:**
- The content includes a section on running shellcheck: `shellcheck script.sh`
- The content includes a section on checking multiple files: `shellcheck *.sh`
- The content includes a section on severity levels (error, warning, info, style)
- The content includes a section on common shellcheck warnings and fixes (SC2086, SC2046, SC2034, etc.)

#### Test 2: Covers directive usage

**Description:** Validates coverage of inline shellcheck directives for suppressing warnings.

**Given:**
- The file `skills/bash-testing-conventions/reference/shellcheck-guide.md` exists

**When:**
- The file content is inspected for directive documentation

**Then:**
- The content documents the `# shellcheck disable=SCXXXX` directive
- The content documents `# shellcheck source=path` for sourced files
- The content documents `# shellcheck shell=bash` for shell specification
- The content includes guidance on when it is appropriate vs inappropriate to suppress warnings

#### Test 3: Covers integration with TDD workflow

**Description:** Validates that the document explains how shellcheck fits into the TDD red-green-refactor cycle.

**Given:**
- The file `skills/bash-testing-conventions/reference/shellcheck-guide.md` exists

**When:**
- The file content is inspected for TDD workflow integration

**Then:**
- The content includes the command for static analysis: `shellcheck -S warning script.sh`
- The content explains that shellcheck serves the same role as `dart analyze` or `clang-tidy`
- The content includes a references section with link to shellcheck wiki

#### Edge Cases

**Description:** Content isolation check.

**Given:**
- The file `skills/bash-testing-conventions/reference/shellcheck-guide.md` exists

**When:**
- The file content is checked for completeness

**Then:**
- The document does not reference Dart or C++ tools
- The document does not contain unfilled template placeholders

#### Acceptance Criteria
- [x] All tests pass
- [x] shellcheck-guide.md covers: basic usage, severity levels, common warnings, directives, TDD integration
- [x] Document depth is comparable to googlemock-guide.md or cmake-integration.md
- [x] Shellcheck commands use correct syntax

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** Slice 1 | **Blocks:** Slice 6, Slice 7a

---

### Slice 4: validate-tdd-order.sh Recognizes Bash Test Files

**Status:** done

**Source:** `hooks/validate-tdd-order.sh`
**Tests:** `test/hooks/validate_tdd_order_test.sh`

#### Test 1: Allows _test.sh files through (test file detection)

**Description:** Validates that bash test files are recognized and allowed through the pre-tool-use hook, just like `_test.dart` and `_test.cpp`.

**Given:**
- The `validate-tdd-order.sh` hook is available
- A PreToolUse JSON payload is provided on stdin with structure `{"tool_name": "Write", "tool_input": {"file_path": "test/hooks/my_test.sh", "content": "..."}}`

**When:**
- The hook script reads stdin and extracts `tool_input.file_path` via jq

**Then:**
- The exit code is 0 (allowed)

#### Test 2: Allows test directory .sh files through

**Description:** Validates that `.sh` files in a `/test/` directory path are allowed.

**Given:**
- The `validate-tdd-order.sh` hook is available
- A PreToolUse JSON payload is provided: `{"tool_name": "Write", "tool_input": {"file_path": "test/hooks/some_helper.sh"}}`

**When:**
- The hook script processes the input

**Then:**
- The exit code is 0 (allowed — path contains `/test/`)

#### Test 3: Blocks .sh source files when no tests written

**Description:** Validates that non-test `.sh` source files are blocked when no test files have been modified.

**Given:**
- The `validate-tdd-order.sh` hook is available
- A PreToolUse JSON payload is provided: `{"tool_name": "Write", "tool_input": {"file_path": "hooks/my_script.sh", "content": "..."}}`
- `git diff --name-only HEAD` returns no files matching `_test.sh`

**When:**
- The hook script reads stdin, extracts `tool_input.file_path`, identifies `.sh` as a source extension, and checks git for recent test file modifications

**Then:**
- The exit code is 2 (blocked)
- Stderr contains the "BLOCKED" message about writing tests first

#### Test 4: Allows .sh source files after test files written

**Description:** Validates that `.sh` source files are allowed after bash test files have been modified.

**Given:**
- The `validate-tdd-order.sh` hook is available
- A PreToolUse JSON payload is provided: `{"tool_name": "Edit", "tool_input": {"file_path": "hooks/my_script.sh", "old_string": "...", "new_string": "..."}}`
- `git diff --name-only HEAD` includes at least one `_test.sh` file

**When:**
- The hook script processes the input

**Then:**
- The exit code is 0 (allowed)

#### Test 5: Existing dart/cpp behavior is unchanged

**Description:** Validates that the changes do not alter behavior for `.dart` and `.cpp` files.

**Given:**
- The `validate-tdd-order.sh` hook is available

**When:**
- A PreToolUse JSON with `tool_input.file_path` of `test/widget_test.dart` is processed
- A PreToolUse JSON with `tool_input.file_path` of `test/unit_test.cpp` is processed
- A PreToolUse JSON with `tool_input.file_path` of `lib/main.dart` is processed (with no tests modified)

**Then:**
- `_test.dart` is allowed (exit 0)
- `_test.cpp` is allowed (exit 0)
- `.dart` source with no tests is blocked (exit 2)

#### Edge Cases

**Description:** Non-source files still pass through.

**Given:**
- The `validate-tdd-order.sh` hook is available
- A PreToolUse JSON payload is provided with `tool_input.file_path` pointing to a non-source file like `README.md` or `pubspec.yaml`

**When:**
- The hook script processes the input

**Then:**
- The exit code is 0 (non-source files are always allowed)
- This confirms `.sh` was added to the source file detection regex alongside `.dart|.cpp|.cc|.h|.hpp`, not replacing them

#### Acceptance Criteria
- [x] All tests pass
- [x] `_test.sh` files are allowed through unconditionally
- [x] `.sh` source files are blocked when no test files written (including `_test.sh` in the git diff check)
- [x] `.sh` source files are allowed after test files written
- [x] Existing `.dart` and `.cpp` behavior is identical to before the change
- [x] Non-source files (`.md`, `.json`, `.yaml`) still pass through unconditionally
- [x] Tests use the real PreToolUse JSON structure (`tool_input.file_path`)

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** none | **Blocks:** Slice 6

---

### Slice 5: auto-run-tests.sh Runs bashunit for Shell Files

**Status:** done

**Source:** `hooks/auto-run-tests.sh`
**Tests:** `test/hooks/auto_run_tests_test.sh`

#### Test 1: Detects .sh file changes and triggers bashunit

**Description:** Validates that when a `.sh` file is modified, the hook attempts to run bashunit on the corresponding test file.

**Given:**
- The `auto-run-tests.sh` hook is available
- A PostToolUse JSON payload is provided on stdin with `tool_input.file_path` pointing to a `.sh` source file (e.g., `hooks/my_script.sh`)
- A matching `_test.sh` file exists (e.g., `test/hooks/my_script_test.sh`)
- `bashunit` command is available on PATH

**When:**
- The hook script processes the input

**Then:**
- The hook outputs JSON with a `systemMessage` field
- The system message references running bashunit on the test file

#### Test 2: Detects _test.sh file directly and runs bashunit on it

**Description:** Validates that when a test file itself is modified, bashunit runs on that file.

**Given:**
- The `auto-run-tests.sh` hook is available
- A PostToolUse JSON payload is provided with `tool_input.file_path` pointing to a `_test.sh` file

**When:**
- The hook script processes the input

**Then:**
- The hook outputs JSON with a `systemMessage` referencing bashunit on the `_test.sh` file itself

#### Test 3: Reports when no matching test file found for .sh

**Description:** Validates the fallback message when no corresponding test file exists.

**Given:**
- The `auto-run-tests.sh` hook is available
- A PostToolUse JSON payload with `tool_input.file_path` pointing to `hooks/orphan.sh`
- No file `test/hooks/orphan_test.sh` exists

**When:**
- The hook script processes the input

**Then:**
- The hook outputs JSON with a `systemMessage` indicating no matching test file was found

#### Test 4: Existing dart and cpp behavior unchanged

**Description:** Validates that `.dart` and `.cpp` file handling is not altered.

**Given:**
- The `auto-run-tests.sh` hook is available

**When:**
- A PostToolUse JSON with `tool_input.file_path` of a `.dart` file is processed
- A PostToolUse JSON with `tool_input.file_path` of a `.cpp` file is processed

**Then:**
- `.dart` files still trigger `flutter test` (or `fvm flutter test`)
- `.cpp` files still trigger `cmake --build build/`
- Neither triggers bashunit

#### Edge Cases

**Description:** Graceful degradation when bashunit is not installed.

**Given:**
- The `auto-run-tests.sh` hook is available
- A PostToolUse JSON payload with `tool_input.file_path` pointing to a `.sh` source file
- `bashunit` is NOT available on PATH

**When:**
- The hook script processes the input

**Then:**
- The hook outputs JSON with a `systemMessage` indicating bashunit is not installed
- The script does not crash or produce an error exit code

#### Acceptance Criteria
- [x] All tests pass
- [x] `.sh` source files trigger bashunit on the matching `_test.sh` file
- [x] `_test.sh` files trigger bashunit on themselves
- [x] Missing test files produce an informative message
- [x] Missing bashunit binary produces an informative message
- [x] Existing `.dart` and `.cpp` behavior is unchanged
- [x] The hook maps source path to test path correctly (e.g., `hooks/foo.sh` -> `test/hooks/foo_test.sh`)

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** none | **Blocks:** Slice 6

---

### Slice 6: Verifier Agent and Settings Update

**Status:** done

**Source:** `agents/tdd-verifier.md`, `.claude/settings.local.json`
**Tests:** `test/agents/tdd_verifier_bash_test.sh`

#### Test 1: Verifier mentions bashunit as test runner for bash

**Description:** Validates that the verifier agent's verification checklist includes bashunit as the test runner for bash/shell projects.

**Given:**
- The file `agents/tdd-verifier.md` exists

**When:**
- The file content is inspected for bash/shell verification instructions

**Then:**
- The verification checklist includes bashunit as the test command for bash
- The static analysis section includes shellcheck for bash files
- The existing Dart and C++ entries are unchanged

#### Test 2: settings.local.json includes shellcheck and bashunit permissions

**Description:** Validates that shellcheck and bashunit are added to allowed permissions so they can run without prompting. Note: this file is gitignored (development-environment only).

**Given:**
- The file `.claude/settings.local.json` exists (gitignored, development-environment only)

**When:**
- The JSON content is parsed

**Then:**
- The `permissions.allow` array contains `"Bash(shellcheck *)"` (space syntax, not deprecated colon syntax)
- The `permissions.allow` array contains `"Bash(bashunit *)"`
- All previously existing permission entries are still present and unmodified

#### Test 3: Existing verifier dart/cpp checks unchanged

**Description:** Validates that the verifier still references dart analyze and ctest.

**Given:**
- The file `agents/tdd-verifier.md` exists

**When:**
- The file content is inspected

**Then:**
- The content still includes `flutter test` for Dart/Flutter
- The content still includes `dart analyze` for Dart static analysis
- The content still includes C++ test command references (ctest)

#### Edge Cases

**Description:** JSON validity and permission format check.

**Given:**
- The file `.claude/settings.local.json` exists

**When:**
- The JSON is validated for structural correctness

**Then:**
- The JSON is valid (parseable by `jq`)
- No existing permissions were removed or modified
- Permission strings use the space-based syntax (`Bash(command *)`) not the deprecated colon syntax (`Bash(command:*)`)

#### Acceptance Criteria
- [x] All tests pass
- [x] Verifier agent mentions bashunit for bash test suite execution
- [x] Verifier agent mentions shellcheck for bash static analysis
- [x] settings.local.json has `Bash(shellcheck *)` and `Bash(bashunit *)` in allowed permissions
- [x] Existing Dart and C++ verifier behavior references are unchanged
- [x] settings.local.json JSON is valid
- [x] Note: settings.local.json is gitignored — users must add these permissions themselves (documented in Slice 7b)

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** Slices 1, 2, 3, 4, 5 | **Blocks:** Slice 7a

---

### Slice 7a: Agent Frontmatter and tdd-plan SKILL.md

**Status:** done

**Source:** `agents/tdd-planner.md`, `agents/tdd-implementer.md`, `skills/tdd-plan/SKILL.md`
**Tests:** `test/integration/bash_agent_skills_test.sh`

#### Test 1: Planner agent references bash-testing-conventions

**Description:** Validates that the planner agent knows to load bash conventions.

**Given:**
- The file `agents/tdd-planner.md` exists

**When:**
- The file content is inspected

**Then:**
- The `skills` list in the frontmatter includes `bash-testing-conventions`
- The existing `dart-flutter-conventions` and `cpp-testing-conventions` entries are unchanged

#### Test 2: Implementer agent references bash-testing-conventions

**Description:** Validates that the implementer agent can load bash conventions.

**Given:**
- The file `agents/tdd-implementer.md` exists

**When:**
- The file content is inspected

**Then:**
- The `skills` list in the frontmatter includes `bash-testing-conventions`
- The existing `dart-flutter-conventions` and `cpp-testing-conventions` entries are unchanged

#### Test 3: tdd-plan SKILL.md includes bash project detection

**Description:** Validates that the planner skill knows how to detect bash projects and load bash conventions.

**Given:**
- The file `skills/tdd-plan/SKILL.md` exists

**When:**
- The file content is inspected for bash references

**Then:**
- Step 0 (convention loading) includes a bash project detection condition (e.g., presence of `*_test.sh` files or `.bashunit.yml`)
- Step 0 instructs loading all files in `skills/bash-testing-conventions/reference/`
- Step 2 lists bashunit as a detected test framework alongside flutter_test and GoogleTest

#### Edge Cases

**Description:** Additive-only verification.

**Given:**
- All three agent/skill files exist and have been updated

**When:**
- Existing Dart/Flutter and C++ skill references are checked

**Then:**
- No existing skill references were removed or altered
- Bash skill is additive only

#### Acceptance Criteria
- [x] All tests pass
- [x] Both planner and implementer agent frontmatters list `bash-testing-conventions`
- [x] tdd-plan SKILL.md includes bash project detection in step 0
- [x] tdd-plan SKILL.md lists bashunit in step 2 framework identification
- [x] Existing dart-flutter-conventions and cpp-testing-conventions references unchanged

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** Slices 1, 2, 3, 4, 5, 6 | **Blocks:** Slice 7b

---

### Slice 7b: Documentation (CLAUDE.md, README.md, CHANGELOG.md)

**Status:** done

**Source:** `CLAUDE.md`, `README.md`, `CHANGELOG.md`
**Tests:** `test/integration/bash_documentation_test.sh`

#### Test 1: CLAUDE.md references bash-testing-conventions skill

**Description:** Validates that CLAUDE.md's Plugin Convention Skills table includes the bash skill.

**Given:**
- The file `CLAUDE.md` exists

**When:**
- The file content is inspected for bash-testing-conventions references

**Then:**
- The Plugin Convention Skills table includes a row for `bash-testing-conventions`
- The triggers column mentions `.sh` files
- The reference docs column mentions bashunit-patterns and shellcheck-guide
- The Testing Approach section includes a Bash Testing subsection
- The Pre-Commit Checklist includes `bashunit` and `shellcheck`

#### Test 2: README.md lists bash as a supported language with installation instructions

**Description:** Validates that the README reflects bash as a third supported language and includes setup instructions.

**Given:**
- The file `README.md` exists

**When:**
- The file content is inspected

**Then:**
- The overview mentions bash/shell alongside Dart/Flutter and C++
- The Skills table includes `bash-testing-conventions`
- The File Structure section shows the `bash-testing-conventions/` directory
- Hooks section mentions `.sh` file support
- There is a Prerequisites or Installation section that includes:
  - bashunit installation: `curl -s https://bashunit.typeddevs.com/install.sh | bash` (or equivalent)
  - shellcheck installation: package manager instructions (e.g., `apt install shellcheck`, `brew install shellcheck`)
- There is a note that users must add `Bash(shellcheck *)` and `Bash(bashunit *)` to their `.claude/settings.local.json` permissions

#### Test 3: CHANGELOG.md updated with bash support

**Description:** Validates that the changelog documents the new bash language support.

**Given:**
- The file `CHANGELOG.md` exists

**When:**
- The `[Unreleased]` section is inspected

**Then:**
- There is an entry describing bash-testing-conventions skill addition
- There is an entry describing validate-tdd-order.sh bash support
- There is an entry describing auto-run-tests.sh bashunit integration
- There is an entry describing verifier bash/shellcheck support
- There is an entry describing shellcheck/bashunit permission requirements

#### Edge Cases

**Description:** Additive-only documentation check.

**Given:**
- All documentation files exist and have been updated

**When:**
- Existing Dart/Flutter and C++ references in each file are checked

**Then:**
- No Dart or C++ references were removed or altered
- Bash support is additive only
- All file content is valid markdown

#### Acceptance Criteria
- [x] All tests pass
- [x] CLAUDE.md references bash-testing-conventions in skills table and testing sections
- [x] README.md mentions bash as a third supported language
- [x] README.md includes bashunit and shellcheck installation instructions
- [x] README.md notes that users must add permissions to settings.local.json
- [x] CHANGELOG.md documents all changes under [Unreleased]
- [x] No existing Dart or C++ references were modified or removed

#### Phase Tracking

- **RED:** done
- **GREEN:** done
- **REFACTOR:** done

**Depends on:** Slices 1, 2, 3, 4, 5, 6, 7a | **Blocks:** none

---

## Implementation Requirements

### File Structure

New files:
```
skills/bash-testing-conventions/
  SKILL.md
  reference/
    bashunit-patterns.md
    shellcheck-guide.md
test/
  skills/
    bash_testing_conventions_test.sh
    bashunit_patterns_test.sh
    shellcheck_guide_test.sh
  hooks/
    validate_tdd_order_test.sh
    auto_run_tests_test.sh
  agents/
    tdd_verifier_bash_test.sh
  integration/
    bash_agent_skills_test.sh
    bash_documentation_test.sh
```

Modified files:
```
hooks/validate-tdd-order.sh
hooks/auto-run-tests.sh
agents/tdd-verifier.md
.claude/settings.local.json
CLAUDE.md
README.md
agents/tdd-planner.md
agents/tdd-implementer.md
skills/tdd-plan/SKILL.md
CHANGELOG.md
```

### Test Framework Detection

- **Bash:** bashunit for test execution, shellcheck for static analysis
- Test file convention: `*_test.sh` suffix (mirrors `*_test.dart` and `*_test.cpp`)
- Test directory: `test/` mirroring source structure (same as Dart and C++)

### Dependencies Required
- [ ] bashunit: bash testing framework (installed separately, e.g., `curl -s https://bashunit.typeddevs.com/install.sh | bash`)
- [ ] shellcheck: shell script static analysis (may already be available at `/usr/bin/shellcheck`)
- [ ] External packages needed: yes — bashunit (installation documented in README.md)

### Edge Cases to Handle
- [ ] bashunit not installed — hooks should degrade gracefully with informative message
- [ ] shellcheck not installed — verifier should note it as missing, not crash
- [ ] `.sh` files that are not bash (e.g., zsh, fish) — out of scope, bashunit targets bash
- [ ] Test files with no corresponding source file
- [ ] Source files outside hooks/ directory

---

## Acceptance Criteria

- [ ] All tests pass (both new bash tests and existing dart/cpp-related tests if any)
- [ ] Code follows project style guidelines (shellcheck clean for all `.sh` files)
- [ ] No static analysis errors (`shellcheck` for bash scripts)
- [ ] Edge cases are handled (missing bashunit, missing test files)
- [ ] No breaking changes to existing Dart/Flutter or C++ behavior
- [ ] All three hooks work correctly for `.sh` files
- [ ] bash-testing-conventions skill is loadable by planner and implementer agents
- [ ] CHANGELOG.md updated

---

## Implementation Notes

### Architectural Decisions

**Why mirror the existing skill structure exactly:** The dart-flutter-conventions and cpp-testing-conventions skills both follow an identical pattern: SKILL.md with YAML frontmatter (`name`, `description`, `user-invocable: false`), a body referencing `reference/*.md` files, and a "Running Tests" section. The bash skill must follow this same pattern to be loadable by the same agent infrastructure.

**Why `_test.sh` suffix convention:** This mirrors `_test.dart` and `_test.cpp`, keeping the plugin's test file detection regexes consistent across languages. The validate-tdd-order.sh hook currently uses `_test\.(dart|cpp|cc|h)$` — extending this to include `sh` is the minimal change.

**Why add `.sh` to source file detection in validate-tdd-order.sh:** Currently the hook only considers `.dart|.cpp|.cc|.h|.hpp` as source files. Without adding `.sh`, shell scripts would pass through the hook unchecked, bypassing test-first enforcement.

**Why use space-based permission syntax:** The existing settings.local.json uses deprecated colon syntax (`Bash(dart analyze:*)`). New entries should use the current space syntax (`Bash(shellcheck *)`). Existing entries are left as-is to avoid unrelated changes.

**Source-to-test path mapping for auto-run-tests.sh:** For Dart, the mapping is `lib/foo.dart` -> `test/foo_test.dart`. For bash, the mapping should be `hooks/foo.sh` -> `test/hooks/foo_test.sh` (prepend `test/`, insert `_test` before `.sh`). This follows the same "mirror in test/" principle.

**settings.local.json is gitignored:** This file is for development-environment permissions only. Users must add `Bash(shellcheck *)` and `Bash(bashunit *)` to their own settings. This is documented in README.md (Slice 7b).

### Potential Refactoring Opportunities
- The three `elif` branches in auto-run-tests.sh (dart, cpp, bash) could be extracted into a function table, but this is an implementation-time decision
- The regex in validate-tdd-order.sh accumulates language extensions — a future improvement could externalize this to a config file
- Once bash support works, the plugin's own hooks could be TDD'd as a dogfooding exercise

---

## Test Results Tracking

### Iteration 1 (RED Phase)

**Status:** pending
**Failing Tests:** 8 slices worth
**Notes:** Tests will validate file existence, content patterns, and behavioral correctness of hook scripts

### Iteration 2 (GREEN Phase)

**Status:** pending
**Tests Passed:** 0/8 -> 8/8
**Notes:** Each slice creates the minimum content/changes to satisfy its tests

### Iteration 3 (REFACTOR Phase)

**Status:** pending
**Tests Status:** pass
**Refactoring Done:** TBD at implementation time
**Notes:** Implementer decides whether any cleanup is warranted per slice

---

## Related Issues / Dependencies

- Depends on: bashunit being installable on the system (can be done as part of implementation)
- Blocks: Dogfooding — TDD'ing the plugin's own hook scripts with bashunit

---

## Slice Summary

| # | Slice | Depends On | Blocks |
|---|-------|-----------|--------|
| 1 | bash-testing-conventions Skill Structure | none | 2, 3, 6, 7a |
| 2 | bashunit-patterns.md Reference Document | 1 | 6, 7a |
| 3 | shellcheck-guide.md Reference Document | 1 | 6, 7a |
| 4 | validate-tdd-order.sh Recognizes Bash Test Files | none | 6 |
| 5 | auto-run-tests.sh Runs bashunit for Shell Files | none | 6 |
| 6 | Verifier Agent and Settings Update | 1-5 | 7a |
| 7a | Agent Frontmatter + tdd-plan SKILL.md | 1-6 | 7b |
| 7b | Documentation (CLAUDE.md, README.md, CHANGELOG.md) | 1-7a | none |

---

## Status Vocabulary

Use these values for all status fields in this document and in `.tdd-progress.md`:

| Status | Meaning |
|--------|---------|
| `pending` | Not yet started |
| `in-progress` | Currently being worked on |
| `done` | Completed successfully |
| `pass` | Test/verification passed |
| `fail` | Test/verification failed |
| `skip` | Intentionally skipped |
